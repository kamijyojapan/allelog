# アレログ (Allergy Log)

食事と病院をスマホでつなぐ、アレルギー症状記録PWA（Progressive Web App）です。

**Version:** 2.1.0

<p align="center">
  <img src="icon-192.png" width="120" alt="アレログ Icon">
</p>

## 📌 コンセプト
**「記録は簡単に、診断は的確に」**

* **患者さんの負担を最小限に:** * 食事は写真を撮るだけ。
    * 服薬は最初に登録した薬剤を選ぶだけ。
    * 毎日の入力を極限まで簡便にすることで、継続率を高めます。
* **「証拠」を自動保存:**
    * 症状を入力した際、**「設定された遡り日数分の食事と服薬の記録」**を自動的にパッケージ化して保存します。後から食事ログを整理しても、診断に必要なデータは消えません。

## 👨‍⚕️ ドクターモード
医師とのコミュニケーションを支援する専用モードを搭載しています。

* **使い方:** 画面右上の 🏥（病院アイコン）をタップします。
* **機能:**
    * **カレンダー:** 症状が出た日だけが強調され、重症度（1〜5）が数字で表示されます。頻度と強さがひと目でわかります。
    * **タイムライン:** 症状の記録のみがフィルタリング表示されます。
    * **詳細確認:** 記録をタップすると、発症直前の設定された遡り日数分の「何を食べていたか」「薬を飲んでいたか」を即座に確認できます。
    * **レポート共有:** 📨ボタンをタップすると、その月の症状データをHTML形式でレポート化し、メールやLINEで医師に送ることができます。受け取った医師は、PCで**アレログ・マネージャー**（`manager.html`）を開き、HTMLファイルをドラッグ＆ドロップすることで、詳細な分析とCSV出力が可能になります。

## 📱 機能一覧
1.  **食事記録:** カメラ撮影またはアルバム選択。タグ（特定原材料、時間、場所）付け。
2.  **服薬記録:** よく使う薬をプリセット登録し、ワンタップで記録。
3.  **症状記録:** 部位、重症度、写真、メモ。過去ログの自動スナップショット保存（編集で日時を変更した場合は同梱データも更新）。
4.  **データ管理:** 全データをJSON形式でバックアップ・復元（機種変更対応）。
5.  **PWA対応:** インストール可能、オフライン動作（圏外の病院内でも閲覧・記録可能）。
6.  **プライバシー:** サーバーを持たず、すべてのデータはユーザーの端末内（IndexedDB）にのみ保存される「ローカルファースト」設計。

## 💻 アレログ・マネージャー（PC用管理ツール）
医療機関向けの患者データ管理ツールです。プロジェクト内の `manager.html` をブラウザで開くだけで利用できます。

### 機能
* **複数患者の一元管理:** ドラッグ＆ドロップで複数のHTMLレポートを読み込み
* **検索機能:** 患者名やカルテIDで瞬時に検索
* **詳細表示:** 症状写真、スナップショット（食事・服薬）をビジュアルに表示
* **CSV出力:** Excel互換形式（BOM付きUTF-8）で統計分析用データを生成

### 使い方

#### 方法1: サーバーモード（推奨） - スマホから直接送信

1. **PCでサーバーを起動**:
   ```bash
   npm install  # 初回のみ
   npm start
   ```
   起動すると、ローカルIPアドレスが表示されます（例: `192.168.1.100`）

2. **スマホで設定**:
   - アレログの設定画面 → 「サーバー送信設定」
   - PCのIPアドレスを入力

3. **レポート送信**:
   - ドクターモード → 📡 ボタンをタップ
   - 自動的にPCに送信され、マネージャー画面に表示

4. **PCで確認**:
   - ブラウザで `http://localhost:8080/manager.html` を開く
   - 受信したレポートが自動表示される

#### 方法2: ファイル転送モード

1. PCのブラウザで `manager.html` を開く
2. 患者から受け取ったHTMLファイルをドラッグ＆ドロップ
3. サイドバーから患者を選択して詳細表示
4. 必要に応じてCSV出力

**注意**: すべての処理はローカルネットワーク内で完結し、データは外部に送信されません。

## 🛠 技術スタック
* HTML5 / CSS3
* Vanilla JavaScript (ES Modules)
* IndexedDB (Local Database)
* Service Worker (Offline Support)

## 🚀 インストール方法
1.  ブラウザでアプリのURLにアクセスします。
2.  **iPhone (Safari):** 「共有」ボタン → 「ホーム画面に追加」
3.  **Android (Chrome):** メニュー「︙」 → 「アプリをインストール」

## 🆕 最近の更新
- **v2.0.0で大幅刷新**: サーバー依存を完全に廃止し、HTML埋め込み型レポート生成機能に移行。PCツール「アレログ・マネージャー」を追加（2026-02-16）。
- 症状記録に「誘因・状況」チェックボックスを追加。運動、ストレス、睡眠不足、体調不良の4項目から選択可能に（v1.4.0）。

---
License: MIT