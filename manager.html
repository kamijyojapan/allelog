<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ¬ãƒ­ã‚°ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</title>
    <style>
        :root {
            --primary: #2196f3;
            --bg: #f5f7fa;
            --border: #e0e0e0;
            --text: #333;
        }
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .sidebar-header {
            padding: 20px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .file-count {
            font-size: 0.85rem;
            background: rgba(255,255,255,0.2);
            padding: 3px 10px;
            border-radius: 12px;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢ */
        .file-drop-area {
            margin: 15px;
            padding: 30px 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            background: #fafafa;
        }
        .file-drop-area:hover {
            background: #e3f2fd;
            border-color: var(--primary);
        }
        .file-drop-area.drag-over {
            background: #e3f2fd;
            border-color: var(--primary);
            transform: scale(1.02);
        }

        /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ */
        .search-box-container {
            padding: 0 15px 15px 15px;
        }
        .search-box {
            width: 100%;
            padding: 10px 12px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: 0.2s;
        }
        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        /* æ‚£è€…ãƒªã‚¹ãƒˆ */
        .patient-list {
            flex: 1;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .patient-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        .patient-item:hover {
            background: #f5f5f5;
        }
        .patient-item.active {
            background: #e3f2fd;
            border-left: 4px solid var(--primary);
        }
        .patient-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        .patient-meta {
            font-size: 0.85rem;
            color: #666;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
        .toolbar {
            padding: 20px 25px;
            background: white;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .current-view-title {
            margin: 0;
            font-size: 1.3rem;
            color: var(--text);
        }
        .toolbar-actions {
            display: flex;
            gap: 10px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            padding: 10px 18px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            font-weight: 500;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: #4caf50;
            color: white;
        }
        .btn-outline {
            background: white;
            border: 1px solid #ccc;
            color: #333;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* ãƒ¬ãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ */
        .report-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: 0.2s;
        }
        .report-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 12px;
            margin-bottom: 15px;
        }
        .report-date {
            font-weight: bold;
            color: #555;
            font-size: 1rem;
        }
        .severity-badge {
            background: #e53935;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* ãƒ¬ãƒãƒ¼ãƒˆè©³ç´° */
        .report-detail {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 12px;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        .detail-label {
            color: #666;
            font-weight: 500;
        }
        .detail-value {
            color: #333;
        }

        /* èª˜å› ã‚¿ã‚° */
        .trigger-tag {
            display: inline-block;
            background: #fff3e0;
            color: #e65100;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-right: 6px;
            margin-bottom: 4px;
        }

        /* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ */
        .snapshot {
            background: #f9f9f9;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            border-left: 4px solid #4caf50;
        }
        .snapshot-title {
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        .snapshot-item {
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #555;
        }

        /* å†™çœŸã‚°ãƒªãƒƒãƒ‰ */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        .photo-grid img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid var(--border);
            cursor: zoom-in;
            transition: all 0.2s;
        }
        .photo-grid img:hover {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* ç©ºã®çŠ¶æ…‹ */
        .empty-state {
            text-align: center;
            color: #999;
            margin-top: 120px;
        }
        .empty-state h3 {
            margin-bottom: 10px;
            color: #666;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
    </style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header">
        <span>ğŸ¥ ã‚¢ãƒ¬ãƒ­ã‚°ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</span>
        <span id="file-count" class="file-count">0ä»¶</span>
    </div>
    <div class="file-drop-area" id="drop-zone">
        ğŸ“‚ ã“ã“ã«HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—<br>
        <small style="color:#999;">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</small>
        <input type="file" id="file-input" multiple accept=".html" style="display:none">
    </div>
    <div class="search-box-container">
        <input type="text" id="search-box" class="search-box" placeholder="ğŸ” æ‚£è€…åã‚„ã‚«ãƒ«ãƒ†IDã§æ¤œç´¢">
    </div>
    <ul class="patient-list" id="patient-list"></ul>
</div>

<div class="main">
    <div class="toolbar">
        <h2 id="current-view-title" class="current-view-title">ãƒ¬ãƒãƒ¼ãƒˆè©³ç´°</h2>
        <div class="toolbar-actions">
            <button class="btn btn-outline" onclick="clearAll()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
            <button class="btn btn-primary" onclick="downloadCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>
        </div>
    </div>
    <div class="content-area" id="content-area">
        <div class="empty-state">
            <h3>ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</h3>
            <p>å·¦ä¸Šã®ã‚¨ãƒªã‚¢ã«ã€ã‚¹ãƒãƒ›ã‹ã‚‰é€ã‚‰ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’<br>ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>
</div>

<script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let reports = [];
    let currentReport = null;

    // èª˜å› ãƒ©ãƒ™ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆapp.jsã¨åŒã˜ï¼‰
    const TRIGGER_LABELS = {
        'exercise': 'é‹å‹•',
        'stress': 'ã‚¹ãƒˆãƒ¬ã‚¹',
        'sleep_lack': 'ç¡çœ ä¸è¶³',
        'illness': 'ä½“èª¿ä¸è‰¯'
    };

    // DOMè¦ç´ 
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const searchBox = document.getElementById('search-box');
    const patientList = document.getElementById('patient-list');
    const fileCount = document.getElementById('file-count');
    const contentArea = document.getElementById('content-area');
    const currentViewTitle = document.getElementById('current-view-title');

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    dropZone.onclick = () => fileInput.click();

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        handleFiles(e.dataTransfer.files);
    });

    fileInput.onchange = (e) => handleFiles(e.target.files);
    searchBox.oninput = renderSidebar;

    // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ï¼šæœ€æ–°å„ªå…ˆï¼‹æ¬ æè£œå®Œï¼‰
    async function handleFiles(files) {
        for (const file of files) {
            if (!file.name.endsWith('.html')) continue;

            try {
                const text = await file.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const script = doc.getElementById('raw-data');

                if (script) {
                    const json = JSON.parse(script.textContent);
                    const key = `${json.chartId}_${json.year}_${json.month}`;

                    // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                    const existingIndex = reports.findIndex(r =>
                        `${r.chartId}_${r.year}_${r.month}` === key
                    );

                    if (existingIndex >= 0) {
                        // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸ï¼ˆæœ€æ–°å„ªå…ˆï¼‹æ¬ æè£œå®Œï¼‰
                        reports[existingIndex] = mergeReports(reports[existingIndex], json);
                    } else {
                        reports.push(json);
                    }
                }
            } catch (err) {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', err);
                alert(`ãƒ•ã‚¡ã‚¤ãƒ« "${file.name}" ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚`);
            }
        }
        renderSidebar();
    }

    // ãƒ¬ãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸é–¢æ•°ï¼šæœ€æ–°ãƒ•ã‚¡ã‚¤ãƒ«å„ªå…ˆã€æ¬ æãƒ‡ãƒ¼ã‚¿ã¯å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è£œå®Œ
    function mergeReports(existing, incoming) {
        // submittedAt ã§æ–°æ—§åˆ¤å®šï¼ˆæ–°ã—ã„æ–¹ã‚’åŸºæº–ã¨ã™ã‚‹ï¼‰
        const existingTime = new Date(existing.submittedAt).getTime();
        const incomingTime = new Date(incoming.submittedAt).getTime();

        let base, supplement;
        if (incomingTime >= existingTime) {
            // æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŸºæº–ã€å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã§è£œå®Œ
            base = incoming;
            supplement = existing;
        } else {
            // æ—¢å­˜ãŒæ–°ã—ã„å ´åˆã¯ã€æ—¢å­˜ã‚’åŸºæº–ã€æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã§è£œå®Œ
            base = existing;
            supplement = incoming;
        }

        // itemsé…åˆ—ã®ãƒãƒ¼ã‚¸ï¼ˆIDãƒ™ãƒ¼ã‚¹ï¼‰
        const mergedItemsMap = new Map();

        // åŸºæº–ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’å„ªå…ˆçš„ã«æ ¼ç´
        base.items.forEach(item => {
            mergedItemsMap.set(item.id, item);
        });

        // è£œå®Œãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€åŸºæº–ã«ãªã„ãƒ‡ãƒ¼ã‚¿ã®ã¿è¿½åŠ ï¼ˆæ¬ æè£œå®Œï¼‰
        supplement.items.forEach(item => {
            if (!mergedItemsMap.has(item.id)) {
                mergedItemsMap.set(item.id, item);
            }
        });

        // IDã§ã‚½ãƒ¼ãƒˆï¼ˆæ™‚ç³»åˆ—é †ï¼‰
        const mergedItems = Array.from(mergedItemsMap.values())
            .sort((a, b) => b.id - a.id); // æ–°ã—ã„é †

        return {
            ...base,
            items: mergedItems,
            _mergedFrom: `${base.submittedAt} (base) + ${supplement.submittedAt} (è£œå®Œ)`
        };
    }

    // ã‚µã‚¤ãƒ‰ãƒãƒ¼æç”»
    function renderSidebar() {
        const filter = searchBox.value.toLowerCase();
        patientList.innerHTML = '';
        fileCount.textContent = `${reports.length}ä»¶`;

        const filteredReports = reports.filter(r =>
            r.patientName.toLowerCase().includes(filter) ||
            r.chartId.toLowerCase().includes(filter)
        );

        if (filteredReports.length === 0 && reports.length > 0) {
            patientList.innerHTML = '<li style="padding:20px; text-align:center; color:#999;">æ¤œç´¢çµæœãªã—</li>';
            return;
        }

        filteredReports.forEach((r) => {
            const li = document.createElement('li');
            li.className = 'patient-item';
            li.innerHTML = `
                <div class="patient-name">${escapeHtml(r.patientName)}</div>
                <div class="patient-meta">
                    ID: ${escapeHtml(r.chartId)} | ${r.year}å¹´${r.month}æœˆ
                </div>
            `;
            li.onclick = () => showDetail(r, li);
            patientList.appendChild(li);
        });
    }

    // è©³ç´°è¡¨ç¤º
    function showDetail(report, liElement) {
        currentReport = report;

        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã®æ›´æ–°
        document.querySelectorAll('.patient-item').forEach(e => e.classList.remove('active'));
        if (liElement) liElement.classList.add('active');

        // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
        currentViewTitle.textContent = `${report.patientName} æ§˜ï¼ˆ${report.year}å¹´${report.month}æœˆï¼‰`;

        // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        let html = '';
        report.items.forEach(item => {
            const date = new Date(item.id);

            // èª˜å› ã‚¿ã‚°
            const triggersHtml = (item.triggers || [])
                .map(t => `<span class="trigger-tag">${TRIGGER_LABELS[t] || t}</span>`)
                .join('');

            // ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
            let snapshotHtml = '';
            if (item.snapshot) {
                const mealsHtml = (item.snapshot.meals || [])
                    .map(m => `<div class="snapshot-item">ğŸ½ï¸ ${escapeHtml(m.tags.join(', '))}</div>`)
                    .join('');
                const medsHtml = (item.snapshot.meds || [])
                    .map(m => {
                        const medList = m.items.map(i => `${escapeHtml(i.name)}(${i.count})`).join(', ');
                        return `<div class="snapshot-item">ğŸ’Š ${medList}</div>`;
                    })
                    .join('');

                if (mealsHtml || medsHtml) {
                    snapshotHtml = `
                        <div class="snapshot">
                            <div class="snapshot-title">ğŸ“ ç—‡çŠ¶ç™ºç”Ÿå‰ã®è¨˜éŒ²ï¼ˆè‡ªå‹•ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰</div>
                            ${mealsHtml}
                            ${medsHtml}
                        </div>
                    `;
                }
            }

            // å†™çœŸã‚°ãƒªãƒƒãƒ‰
            const photosHtml = item.photos && item.photos.length > 0
                ? `<div class="photo-grid">
                    ${item.photos.map(p => `<img src="${p}" onclick="window.open(this.src)" alt="ç—‡çŠ¶å†™çœŸ">`).join('')}
                   </div>`
                : '';

            html += `
                <div class="report-card">
                    <div class="report-header">
                        <span class="report-date">${date.toLocaleString('ja-JP')}</span>
                        <span class="severity-badge">é‡ç—‡åº¦ Lv.${item.severity}</span>
                    </div>
                    <div class="report-detail">
                        <div class="detail-label">éƒ¨ä½</div>
                        <div class="detail-value">${escapeHtml(item.parts || '-')}</div>

                        <div class="detail-label">èª˜å› ãƒ»çŠ¶æ³</div>
                        <div class="detail-value">${triggersHtml || '-'}</div>

                        <div class="detail-label">è©³ç´°ãƒ¡ãƒ¢</div>
                        <div class="detail-value" style="white-space: pre-wrap;">${escapeHtml(item.note || '-')}</div>
                    </div>
                    ${snapshotHtml}
                    ${photosHtml}
                </div>
            `;
        });

        contentArea.innerHTML = html;
    }

    // CSVå‡ºåŠ›
    function downloadCSV() {
        if (reports.length === 0) {
            alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            return;
        }

        let csv = 'ã‚«ãƒ«ãƒ†ID,æ‚£è€…æ°å,å¯¾è±¡å¹´,å¯¾è±¡æœˆ,æ—¥æ™‚,é‡ç—‡åº¦,éƒ¨ä½,èª˜å› ,è©³ç´°ãƒ¡ãƒ¢,ç›´å‰ã®é£Ÿäº‹ã‚¿ã‚°,æœè–¬å†…å®¹\n';

        reports.forEach(r => {
            r.items.forEach(item => {
                const date = new Date(item.id).toLocaleString('ja-JP');
                const triggers = (item.triggers || [])
                    .map(t => TRIGGER_LABELS[t] || t)
                    .join('/');

                let mealsStr = '';
                let medsStr = '';
                if (item.snapshot) {
                    if (item.snapshot.meals) {
                        mealsStr = item.snapshot.meals
                            .map(m => m.tags.join(' '))
                            .join(' | ');
                    }
                    if (item.snapshot.meds) {
                        medsStr = item.snapshot.meds
                            .map(m => m.items.map(i => `${i.name}(${i.count})`).join(' '))
                            .join(' | ');
                    }
                }

                const row = [
                    r.chartId,
                    r.patientName,
                    r.year,
                    r.month,
                    date,
                    item.severity,
                    item.parts || '',
                    triggers,
                    item.note || '',
                    mealsStr,
                    medsStr
                ].map(v => `"${(v || '').toString().replace(/"/g, '""')}"`).join(',');

                csv += row + '\n';
            });
        });

        // BOMä»˜ãUTF-8ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆExceläº’æ›ï¼‰
        const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `allelog_export_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // ã‚¯ãƒªã‚¢
    function clearAll() {
        if (reports.length === 0) return;

        if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
            reports = [];
            currentReport = null;
            renderSidebar();
            contentArea.innerHTML = `
                <div class="empty-state">
                    <h3>ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ</h3>
                    <p>æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            `;
            currentViewTitle.textContent = 'ãƒ¬ãƒãƒ¼ãƒˆè©³ç´°';
        }
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
</body>
</html>
