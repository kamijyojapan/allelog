# 変更履歴 (Changelog)

## [1.3.4] - 2026-02-08

### 改善
- **レポート作成の信頼性向上**: ファイル書き込み完了を待つため、キュー方式に変更。作成から10秒以上経過したファイルのみを処理することで、データの完全性を確保
- **処理時間の最適化**: 1〜2分以内にレポートが作成されるよう調整

## [1.3.3] - 2026-02-08

### 改善
- **レポート作成処理を高速化**: データ送信時に即座にPDF作成を試みるハイブリッド方式を採用
- **サーバー負荷を軽減**: 定期チェック処理を最適化し、キューが空の場合は早期リターンするように改善

## [1.3.2] - 2026-02-08

### 修正
- **医師用レポートで複数写真が表示されない問題を修正**: 食事記録・症状記録で添付した全ての写真が医師用PDFレポートに正しく含まれるように修正

## [1.3.1] - 2026-02-08

### 修正
- **設定画面の表示不具合を修正**: 設定画面を開いた際に、以前保存したカルテIDと患者氏名が正しく表示されるように修正

## [1.3.0] - 2026-02-07

### 追加
- **食事記録・症状記録の写真を4枚まで添付可能**: 複数の角度から食事や症状を記録できるようになりました
- **2x2グリッドレイアウト**: 写真プレビューをグリッド表示し、一覧性を向上
- **各写真に個別削除ボタン**: 不要な写真だけを削除できるようになりました
- **4枚到達時の案内メッセージ**: 上限に達したことを明確に表示

### 改善
- **既存データとの互換性**: 1枚写真の既存データも引き続き表示・編集可能
- **タイムラインでの複数枚表示**: 最初の1枚をサムネイル表示、2枚以上は右下に枚数バッジを表示
- **詳細モーダルでの複数枚表示**: 全ての写真をグリッド形式で確認可能

## [1.2.8] - 2026-02-05

### 改善
- **デバッグログに閉じるボタンを追加**: モーダル下部に閉じるボタンを配置し、操作性を向上

## [1.2.7] - 2026-02-05

### 変更
- **デバッグログトグルを削除**: 設定画面からトグルスイッチを削除し、`console.log` を常に有効にした
- **デバッグログボタンの文言・アイコン変更**: 「📋 ログを表示」を「🐛 デバッグログを表示」に更新

## [1.2.6] - 2026-02-05

### 追加
- **スナップショット日数設定**: 設定画面で症状記録時の遡り日数を変更できるようにした（デフォルト: 1日）

## [1.2.5] - 2026-02-05

### 変更
- **終了ボタンを削除**: メニューから終了ボタンを削除し、UIをシンプル化

### 改善
- **データ移行画面のUI向上**: 画面下部に「閉じる」ボタンを追加し、操作性を向上

## [1.2.4] - 2026-02-05

### 改善
- **設定画面のUI向上**: 下部に「保存して閉じる」ボタンと「閉じる」ボタンを追加し、操作性を向上

## [1.2.3] - 2026-02-05

### 追加
- **更新履歴モーダル**: 「アレログについて」から更新履歴（CHANGELOG）を全文表示できる画面を追加

### 変更
- **アレログについての文言更新**: 一般向けの説明に刷新し、使い方とデータ取り扱いを明確化

## [1.2.2] - 2026-02-05

### 改善
- **薬剤登録画面の操作性向上**: 画面下部に「閉じる」ボタンを配置し、ユーザビリティを向上

## [1.2.1] - 2026-02-04

### 修正
- **スナップショット処理の安全性向上**: 症状記録送信時にスナップショットの存在確認を改善し、食事データが空でも服薬データを正しく処理できるように修正

## [1.2.0] - 2026-02-04

### 追加
- **ドクターモード送信機能**: ドクターモード時に📤送信ボタンを表示し、症状データを月単位でGASサーバーへ送信
- **患者情報設定**: 設定画面にカルテIDと患者氏名の入力欄を追加し、localStorage で永続化
- **画像データ変換**: 症状記録の画像とスナップショット内の食事画像をBase64形式に変換して送信
- **ローディング画面**: データ送信中のローディングオーバーレイを実装
- **GAS連携**: Google Apps Script で受信したデータからPDFレポートを自動生成する仕組みに対応

### 改善
- 送信時に未入力の場合はプロンプトで入力を促し、入力内容を設定画面にも反映
- 送信確認ダイアログにカルテIDと患者氏名を表示して誤送信を防止

## [1.1.6] - 2026-02-04

### 追加
- デバッグログ機能を追加（設定画面にトグルとログ閲覧モーダルを配置）
- PWA関連イベント（Service Worker登録・beforeinstallprompt・インストール結果など）をログポイントとして収集
- ログは常に収集し、トグルはコンソール出力だけを制御する設計
- インラインスクリプトの SW 登録と beforeinstallprompt にもログポイントを追加

## [1.1.5] - 2026-02-04

### 追加
- アプリ内インストールボタンを追加（side-menu に「📲 アプリとしてインストール」項目を配置）
- Chrome の自動インストールバナーを有効にする（`beforeinstallprompt` の `preventDefault` を削除）
- インストール済み検出（`display-mode: standalone`）でボタンを自動非表示にする
- `appinstalled` イベント対応で、Chromeバナーから先にインストールされた場合にもボタンを非表示にする

## [1.1.4] - 2026-02-04

### 修正
- PWAインストールができない問題を修正（manifest.jsonに`description`フィールドを追加）
- Service Workerで`chrome-extension`等の非HTTPスキームをスキップしてエラーを修正
- Service Workerキャッシュバージョンをv10に更新

## [1.1.3] - 2026-02-04

### 改善
- Service WorkerをNetwork First戦略に変更し、HTML/JSファイルの更新が即座に反映されるように改善
- Persistent Storage APIを実装し、ブラウザのデータ削除でIndexedDBが消えるリスクを軽減
- PWAインストールプロンプトのハンドリングを追加
- Service Workerのキャッシュバージョンをv9に更新

## [1.1.2] - 2026-02-04

### 修正
- ドクターモードの切り替えが反応しない問題を修正
- 記録の日時を編集して保存した際に反映されない問題を修正

### 改善
- 症状記録の参照時に、過去1週間の食事・服薬を再集計して差分があればスナップショットを更新
- 再集計日を記録し、更新があった場合のみ軽く通知

## [1.1.0] - 2026-02-03

### 追加
- ハンバーガーメニューに「設定」画面を追加
- ハンバーガーメニューに「更新」機能を追加（ServiceWorkerの強制更新）
- 設定画面に「ドクターモード説明を再表示」機能を追加
- 下部メニューの現在位置をハイライト表示

### 改善
- モーダルの背景クリックで閉じる機能を実装
- ドクターモードの注意書きを初回のみ表示（設定から再表示可能）
- ドクターモードクリック時にカレンダー画面に自動遷移
- 初期表示時に下部メニューのホームをアクティブ表示

### 変更
- Aboutモーダルを専用画面として分離

## [1.0.0] - 2026-02-03

### 追加
- 初回リリース
- 食事記録機能（写真、タグ、メモ）
- 服薬記録機能（薬剤プリセット管理）
- 症状記録機能（重症度、部位、詳細、過去1週間の自動スナップショット）
- カレンダー表示
- タイムライン表示
- ドクターモード（症状の重症度をカレンダーに数値表示）
- データ移行機能（バックアップ・復元）
- PWA対応（オフライン動作、ホーム画面追加）
